<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BookEat - Add Review</title>
  <link rel="stylesheet" href="review3.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
</head>
<body>
  <header class="navbar">
    <div class="brand">BookEat.com</div>
    <nav class="nav-center">
      <ul>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="restaurant.html">Restaurant</a></li>
        <li><a href="review.html" class="active">Review</a></li>
        <li><a href="reservation.html">Reservation</a></li>
      </ul>
    </nav>
    <div class="hamburger">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </div>
  </header>

  <main class="review-form-container">
    <div class="restaurant-info">
      <div class="pic">PIC</div>
      <div class="info">
        <p class="name">Restaurant's Name</p>
        <div class="rating-stars">
          <span class="star" data-value="1">&#9734;</span>
          <span class="star" data-value="2">&#9734;</span>
          <span class="star" data-value="3">&#9734;</span>
          <span class="star" data-value="4">&#9734;</span>
          <span class="star" data-value="5">&#9734;</span>
        </div>
      </div>
    </div>

    <div class="form-box">
      <div class="stars-selected"></div>
      <textarea id="review-text" placeholder="Choose a rating first, then add a review!"></textarea>
      <div class="button-row">
  <button class="back-btn" onclick="goBack()">Back</button>
  <button id="submit-review">Send</button>
</div>

    </div>
  </main>

  <script>
  const params = new URLSearchParams(window.location.search);
  const idRestoran = params.get('id');
  const id_restoran = parseInt(params.get("id")); // Ambil ID dari URL
  const id_customer = 1; // GANTI dengan ID customer dari session nanti
  let selectedRating = 0;

  const stars = document.querySelectorAll('.star');
  const starsSelected = document.querySelector('.stars-selected');

  // ⭐ Handle klik pada bintang
  stars.forEach(star => {
    star.addEventListener('click', () => {
      selectedRating = parseInt(star.dataset.value);
      updateStars(selectedRating);
    });
  });

  // Fungsi untuk update tampilan bintang
  function updateStars(rating) {
    stars.forEach(star => {
      star.textContent = parseInt(star.dataset.value) <= rating ? '★' : '☆';
    });
    starsSelected.textContent = `Rating: ${rating}`;
  }

  // Load data restoran
  if (idRestoran) {
    fetch(`review3.php?id=${idRestoran}`)
      .then(res => res.json())
      .then(data => {
        if (data.length > 0) {
          document.querySelector('.name').textContent = data[0].nama_restoran;
        } else {
          document.querySelector('.name').textContent = "Restoran Tidak Ditemukan";
        }
      })
      .catch(err => {
        console.error("Gagal fetch data:", err);
      });
  }

  // Tombol submit
  document.getElementById('submit-review').addEventListener('click', () => {
    const text = document.getElementById('review-text').value.trim();

    if (!id_restoran || !selectedRating || !text || !id_customer) {
      alert("Please complete all fields.");
      return;
    }

    fetch('review3.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        id_restoran: id_restoran,
        id_customer: id_customer,
        rating: selectedRating,
        komentar: text
      })
    })
    .then(res => res.json())
    .then(res => {
      if (res.success) {
<<<<<<< HEAD
        window.location.href = 'review.html';
=======
        window.location.href = `review2.php?id_restoran=${id_restoran}`;
>>>>>>> 1c3516549099ba1af1a11cebc2254a39112a0ea6
      } else {
        alert("Error: " + res.error);
      }
    });
  });

  function goBack() {
    window.location.href = `review2.php?id_restoran=${id_restoran}`;
  }
</script>

<<<<<<< HEAD
=======

>>>>>>> 1c3516549099ba1af1a11cebc2254a39112a0ea6
</body>
</html>
